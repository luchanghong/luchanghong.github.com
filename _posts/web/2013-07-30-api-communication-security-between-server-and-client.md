---
layout: post
category: web
tags: [api,security]
title: API通信安全问题
description: 在设计本次移动APP的API之初，为了调试方便并没有加安全验证，最近完善接口把整体布局又重新整理了一次。
---

## 数据传递

- 传递方式

    为了统一规范，放弃了最简单的GET传递方式而采用POST，这也和采用数据传输的形式
    有关。

- 数据形式

    在网页的FORM表单里一般都以`key-value`这种形式发送数据，而接口里把所有的键值
    对组成一个JSON实体传送。

## 数据加密

请求和响应的数据都没有经过什么加密措施，即使加密也要用对称加密的方式，所以倒不
如使用权限验证，过滤非法的请求才是治本。

## 验证授权

这里我使用以下几个步骤：

- 校验参数

    在接口定义好参数的类型和值的范围，如果请求的参数不符合则立刻终止；

    在接口定义必须要传入的参数，如果没有则立刻终止；

- 校验签名

    最常用的方法就是给客户端一个私有的key，每一次请求都拿着key和参数按照一定规则
    混合加密（通常md5方式）生成密文即签名，然后在请求API的时候把这个签名也发送过
    去，服务器端收到请求的时候按照约定好的规则也做一次加密并比对密文。这样的方法
    很简单也很实用，虽然可以防止非法参数的请求，但是一个合法的请求暴露出来之后便
    不会有任何限制，也就是说别人可以DDOS。

    考虑到合法的一次请求会遗留下问题，解决方案就是在合法的请求上加一个时间限制，
    多加一个timestamp的参数并且参与密文的生成，当服务器端接收到请求之后就来比对
    当前时间和参数中的timestamp，相差大于规定时间就终止。这种方法常常有2个疑问：

    - 修改时间参数怎么办？

        因为timestamp是参与加密的，所以修改之后传递过去验证签名就通不过了。

    - 客户端时间和服务前段时间不同步怎么办？

        这个确实有点麻烦，我给出的解决方法是：先请求一下服务器时间，然后和本地时间
        对比获取差值，之后请求接口的timestamp加上或者减去这个差值就OK了。

    更加高级的方式就是使用RSA方式加密了，这里不做过多介绍。
