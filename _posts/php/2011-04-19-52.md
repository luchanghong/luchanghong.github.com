---
layout: post
title: phpmail类发送邮件
category: php
tags: [phpmail,邮件]
date: 2011-04-19
---
<p>前天要给网站做一个小功能，就是在用户留言的时候发邮件通知管理员。我们都知道在PHP里有一个mail函数，但是要求服务器要有邮件服务器的功能，比如简单的SMTP或者POP3。但是，如果我们的服务器没有这种功能，那么怎么办呢？</p>
<p>有了phpmail这个类，你就不用愁了。这是个外国人写的一个类，我们就只管&ldquo;拿来主义&rdquo;了。下面是基于这个类里面的send()方法写的一个函数：</p>
<div style="background-color: rgb(249,247,237)" id="codee_html">&nbsp;</div>
<div style="background-color: rgb(249,247,237)">
<div style="background-color: rgb(249,247,237); font-family: 'Courier New','Consolas','Lucida Console'; color: rgb(0,0,0)" class="source"><span style="color: rgb(0,0,170)">function</span> <span style="color: rgb(0,170,0)">send_mail</span> (<span style="color: rgb(170,0,0)">$title</span><span style="color: rgb(0,0,0)">,</span><span style="color: rgb(170,0,0)">$content</span><span style="color: rgb(0,0,0)">,</span><span style="color: rgb(170,0,0)">$from</span><span style="color: rgb(0,0,0)">,</span><span style="color: rgb(170,0,0)">$to</span><span style="color: rgb(0,0,0)">,</span><span style="color: rgb(170,0,0)">$charset</span><span style="color: rgb(0,0,0)">=</span><span style="color: rgb(170,85,0)">'gbk'</span><span style="color: rgb(0,0,0)">,</span><span style="color: rgb(170,0,0)">$attachment</span> <span style="color: rgb(0,0,0)">=</span><span style="color: rgb(170,85,0)">''</span>)<br />
<span style="color: rgb(0,0,0)">{</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(0,0,170)">include</span> <span style="color: rgb(170,85,0)">'/class/PHPMail.class.php'</span>;<br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(0,170,170)">header</span>(<span style="color: rgb(170,85,0)">'Content-Type: text/html; charset='</span><span style="color: rgb(0,0,0)">.</span><span style="color: rgb(170,0,0)">$charset</span>);<br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span> <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(0,0,170)">new</span> <span style="color: rgb(0,0,0)">PHPMailer</span>(); <br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">CharSet</span> <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(170,0,0)">$charset</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置采用gb2312中文编码</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">IsSMTP</span>();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置采用SMTP方式发送邮件</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">Host</span> <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(170,85,0)">&quot;smtp.qq.com&quot;</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置邮件服务器的地址</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">Port</span> <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(0,153,153)">25</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置邮件服务器的端口，默认为25</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">From</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(170,0,0)">$from</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置发件人的邮箱地址</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">FromName</span> <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(170,85,0)">&quot;&quot;</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置发件人的姓名</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">SMTPAuth</span> <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(0,0,170)">true</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置SMTP是否需要密码验证，true表示需要</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">Username</span> <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(170,0,0)">$from</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置发送邮件的邮箱</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">Password</span> <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(170,85,0)">&quot;&quot;</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置邮箱的密码</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">Subject</span> <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(170,0,0)">$title</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置邮件的标题</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">AltBody</span> <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(170,85,0)">&quot;text/html&quot;</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">// optional, comment out and test</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">Body</span> <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(170,0,0)">$content</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置邮件内容</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">IsHTML</span>(<span style="color: rgb(0,0,170)">true</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置内容是否为html类型</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">WordWrap</span> <span style="color: rgb(0,0,0)">=</span> <span style="color: rgb(0,153,153)">50</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置每行的字符数</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">AddReplyTo</span>(<span style="color: rgb(170,85,0)">&quot;地址&quot;</span><span style="color: rgb(0,0,0)">,</span><span style="color: rgb(170,85,0)">&quot;名字&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置回复的收件人的地址</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">AddAddress</span>(<span style="color: rgb(170,0,0)">$to</span><span style="color: rgb(0,0,0)">,</span><span style="color: rgb(170,85,0)">&quot;星模实训&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置收件的地址</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(0,0,170)">if</span> (<span style="color: rgb(170,0,0)">$attachment</span> <span style="color: rgb(0,0,0)">!=</span> <span style="color: rgb(170,85,0)">''</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-style: italic; color: rgb(170,170,170)">//设置附件</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(0,0,0)">{</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">AddAttachment</span>(<span style="color: rgb(170,0,0)">$attachment</span><span style="color: rgb(0,0,0)">,</span> <span style="color: rgb(170,0,0)">$attachment</span>);<br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(0,0,0)">}</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(0,0,170)">if</span>(<span style="color: rgb(0,0,0)">!</span><span style="color: rgb(170,0,0)">$mail</span><span style="color: rgb(0,0,0)">-&gt;</span><span style="color: rgb(30,144,255)">Send</span>()) <br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(0,0,0)">{</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0,0,170)">return</span> <span style="color: rgb(0,0,170)">false</span>;<br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(0,0,0)">}</span> <span style="color: rgb(0,0,170)">else</span> <span style="color: rgb(0,0,0)">{</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0,0,170)">return</span> <span style="color: rgb(0,0,170)">true</span>;<br />
&nbsp;&nbsp;&nbsp; <span style="color: rgb(0,0,0)">}</span><br />
<span style="color: rgb(0,0,0)">}</span><br />
&nbsp;</div>
</div>
<p>一般就是用QQ邮箱了，因为QQ邮箱很容易开启SMTP和POP3服务，而且免费，注意的就是邮件的内容格式和编码。</p>
<p>PHPMail.class.php这个类，<a href="http://www.luchanghong.com/download/phpmail.rar">点击下载吧</a>！</p>
<div style="padding-bottom: 5px; background-color: rgb(255,255,255); margin: 0px; padding-left: 5px; padding-right: 5px; font-family: Arial, Verdana, sans-serif; font-size: 12px; padding-top: 5px">
<p style="text-align: center"><span style="color: rgb(0,0,255)"><br />
</span><span style="color: rgb(0,0,255)">--------------------------------&nbsp; PHP培训，PHP博客、PHP学习型技术博客，期待与您交流！ -------------------------------<br />
<br />
----------&nbsp; QQ：750881560&nbsp;&nbsp; e-mail：luchanghong@xingmo.com&nbsp; MSN：luchanghong1990@hotmail.com -----------</span></p>
<p style="text-align: center">&nbsp;</p>
</div>
