---
layout: post
title: 考勤系统二三事
category: php
tags: [考勤系统]
date: 2011-03-11
---
<p>这个周末真是什么都没做，好好的出去放松了一下。前段时间做的考勤系统已经差不多交差了，现在回过头来总结一下。</p>
<p>首先，是做事的心态和自信。这是第一次做具体的项目，而且是一个人做。接到任务后，心里的第一反应就是：做出来，我可以的！但是，也不能急于求成，要仔细的分析，理清思路。</p>
<p>其二，做系统为工作生活服务，所以系统要基于生活实例，不能凭空想象。我这次做的考勤系统，分为两块，一个是班级管理系统，然后是以班级为单位的考勤机制。 这样，就清楚了他们之间的关联，据此设计数据库，设计表：班级表、学生表、考勤表，教师登录系统后能看到自己的班级，然后对这个班级的所有学生进行考勤， 把考勤记录上报汇总到考勤表里面。</p>
<p>然后，就要开始设计页面了。系统一定要简单实用，不必太高深，要方便教师操作，提高办事效率。回归到程序的本身，其本质就是对数据库的操作，增删改查，没有新花样。</p>
<p>做完之后，觉得也挺简单的。遇到的最大难题就是关于考勤上报的时间问题：早上学生来了，教师填写信息上报，但是晚上学生走了，教师还要上报一次，中途有早退 或者请假的也要上报，这样，早上第一次是向数据库插入数据（INSERT），接下来当天的操作都是更新数据（UPDATE），根据数据库设计要求，一个学 生每天只能产生一跳记录，难点就是：每次操作都要判断当天记录是否已经上报，都要查表一次才行，因为一个班有好多学生，所以都是一次上报所有学生考勤信 息，不可能单独对某个同学考勤操作。</p>
<p>查表判断并不难，就是WHERE的条件用哪个字段比较合适？单独找学生ID是不行的，因为之前每天都有这个ID的考勤记录，所以还要AND附加一个条件，想想怎样把时间限制在当天呢？我用的是时间相关的函数进行处理判断的：</p>
<p>当 考勤表提交的时候，得到当前的时间$current_time=time()，这是十位数的时间，然后格式化成年月日的日期，这是关 键，$current_date=date('Ymd',$current_time)，接着把这个年月日的日期转化成十位数的时间，很明显这个就是当天 零点零分零秒开始的十位数时间了，$start_time=strtotime($current_date)，加上24小时的秒数就是当天最后一秒的时 间$end_time=$start_time+24*3600</p>
<p>到这里，附加条件就出来了，WHERE `student_id`  = &lsquo;{$id}&rsquo;&nbsp; AND&nbsp; `post_time`&gt;'{$start_time}' AND  `post_time`&lt;'{$end_time}'，根据这个条件判断当天是否已经添加过考勤信息，如果是就更新（UODATE），否则就插入新 记录（INSERT）</p>
<p>写的有点复杂，其实过程挺简单，做了才知道哈！</p>
<p>想到一个东西：权限控制，因为一个系统有不同角色，对应着不同的权限，所以做完这个考勤系统之后，又学到点东西，就是怎样设置权限的问题，肯定是校长权限最高，相当于系统超级管理员，教师只能看到自己的班级，不能提交其他班级的考勤记录等等，这些都要考虑到，要把系统完善起来。</p>
<p>看来，还只是个菜鸟，要学习的还有很多。</p>
